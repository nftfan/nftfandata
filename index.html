<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Post Articles</title>
<script src="https://sdk.amazonaws.com/js/aws-sdk-2.1002.0.min.js"></script>
<style>
    body {
        font-family: Arial, sans-serif;
        margin: 0;
        padding: 0;
        background-color: #000000;
        color: #333; /* Set default text color */
        transition: background-color 0.3s, color 0.3s; /* Add transition effect */
    }
    .container {
        width: 90%;
        margin: 0 auto;
        padding: 20px;
        background-color: #fff;
        border-radius: 5px;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        border: 0px solid;
    }
    .textarea-container {
        position: relative;
    }
    textarea, input[type="text"] {
        width: 100%;
        padding: 5px;
        border: 1px solid;
        border-radius: 5px;
        margin-bottom: 10px;
        background-color: #fff;
        color: #333;
        transition: background-color 0.3s, color 0.3s;
    }
    textarea.dark-mode, input[type="text"].dark-mode {
        background-color: #333;
        color: #fff;
    }
    button {
        padding: 5px 10px;
        background-color: #2196F3;
        color: #fff;
        border: none;
        border-radius: 5px;
        cursor: pointer;
    }
    button:hover {
        background-color: #0b7dda;
		
		.article p {
    word-wrap: break-word;
    overflow-wrap: break-word;
}

    }
    .article {
        border: 1px solid #ccc;
        border-radius: 5px;
        padding: 10px;
        margin-bottom: 15px;
        background-color: #fff;
        color: #333;
        transition: background-color 0.3s, color 0.3s;
    }
    .article.dark-mode {
        background-color: #333;
        color: #fff;
    }
    .title {
        font-weight: bold;
        background-color: #f0f0f0;
        padding: 5px;
        border-radius: 5px;
        margin-bottom: 5px;
        transition: background-color 0.3s;
        position: relative; /* Add position relative */
    }
    .title.dark-mode {
        background-color: #555;
        color: #fff;
    }
    .datetime {
        font-size: 6px;
        color: grey;
    }
    .wallet {
        font-size: 7px;
    }
    .error {
        color: red;
    }
    .toggle-container {
        position: absolute;
        top: 10px;
        right: 10px;
    }
    .toggle-btn {
        width: 40px; /* Decrease width */
        height: 20px; /* Decrease height */
        border-radius: 10px; /* Adjust border radius */
        background-color: #ddd;
        position: relative;
        cursor: pointer;
        transition: background-color 0.3s;
    }
    .toggle-btn::after {
        content: '';
        position: absolute;
        width: 16px;
        height: 16px;
        border-radius: 50%;
        background-color: #fff;
        top: 2px;
        left: 2px;
        transition: left 0.3s;
    }
    .dark-mode body {
        background-color: #333; /* Change background color to dark */
        color: #fff; /* Change text color to light */
    }
    .star-button {
        position: absolute;
        top: 50%;
        right: 10px;
        transform: translateY(-50%);
        cursor: pointer;
        background: none;
        border: none;
        font-size: 16px;
        line-height: 1;
    }
    .star-count {
        position: absolute;
        top: 50%;
        right: 30px;
        transform: translateY(-50%);
        font-size: 14px;
        color: #888;
    }
</style>
</head>
<body>

<div class="container">
    <div class="toggle-container">
        <div class="toggle-btn" onclick="toggleDarkMode()"></div>
    </div>

    <div style="background-color: #ffffff; border: 1px solid #e0e0e0; border-radius: 8px; padding: 15px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); transition: 0.3s;">
        <h1 style="color: #2196F3; text-align: center; font-family: Arial, sans-serif; margin: 0; font-size: 12px;">AI Article Posting Powered by NFTFANS</h1>
    </div>

    <input type="text" id="articleTitle" placeholder="Title of the article...">
    <input type="text" id="walletAddress" placeholder="Your wallet address...">
    <textarea id="articleText" placeholder="Write your article here..."></textarea>
    <button onclick="postArticle()">Post Article</button>

    <div class="error" id="errorMessage"></div>
    
    <div class="articles" id="articlesSection">
        <!-- Articles will be displayed here -->
    </div>
</div>

<script>
    var darkModeEnabled = false;

    function toggleDarkMode() {
        darkModeEnabled = !darkModeEnabled;
        applyDarkMode();
    }

    function applyDarkMode() {
        var elements = document.querySelectorAll('body, .container, .article, .title');
        elements.forEach(function(element) {
            element.classList.toggle('dark-mode', darkModeEnabled);
        });
    }

    // Configure AWS SDK
    AWS.config.update({
        region: 'eu-north-1',
        credentials: new AWS.Credentials('AKIAVRUVVVUMSVIVK2E2', 'LXc6zMSQtlIUl/ONxOYgrgqL8VT014eeUyVimR+Y')
    });

    var dynamodb = new AWS.DynamoDB.DocumentClient();
    var tableName = 'nftfan2'; // Updated table name for articles
    
    // Load articles from DynamoDB when the page loads
    window.onload = function() {
        loadArticles();
    };
    
    function postArticle() {
        var articleTitle = document.getElementById("articleTitle").value.trim();
        var walletAddress = document.getElementById("walletAddress").value.trim();
        var articleText = document.getElementById("articleText").value.trim();
        
        if (!articleTitle || !walletAddress || !articleText) {
            displayError("Please fill in all fields.");
            return;
        }

        // Check if article text exceeds the word limit
        var wordCount = articleText.split(/\s+/).length;
        if (wordCount < 501 || wordCount > 1501) {
            displayError("Please make sure your article is between 501 and 1501 words.");
            return;
        }

        // Call postArticleToDynamoDB to save the article
        postArticleToDynamoDB(articleTitle, walletAddress, articleText);
    }

    function postArticleToDynamoDB(articleTitle, walletAddress, articleText) {
        var params = {
            TableName: tableName,
            Item: {
                nftfan2: Date.now().toString(), // Primary key attribute
                articleId: 'article_' + Date.now().toString(), // Unique article ID
                title: articleTitle,
                wallet: walletAddress,
                text: articleText,
                stars: 0 // Initial star count
            }
        };

        dynamodb.put(params, function (err, data) {
            if (err) {
                displayError("Error posting article: " + err.message);
            } else {
                clearError();
                console.log("Successfully posted article to DynamoDB", data);
                loadArticles(); // Reload articles after posting
            }
        });

        // Clear the input fields after posting the article
        document.getElementById("articleTitle").value = "";
        document.getElementById("walletAddress").value = "";
        document.getElementById("articleText").value = "";
    }
    
    function loadArticles() {
        var params = {
            TableName: tableName
        };
        
        dynamodb.scan(params, function(err, data) {
            if (err) {
                displayError("Error loading articles from DynamoDB: " + err.message);
            } else {
                clearError();
                console.log("Successfully loaded articles from DynamoDB", data);
                displayArticles(data.Items);
            }
        });
    }

   function displayArticles(articles) {
    var articlesSection = document.getElementById("articlesSection");
    articlesSection.innerHTML = ""; // Clear existing articles

    // Sort articles by timestamp in descending order (latest on top)
    articles.sort(function(a, b) {
        return b.nftfan2 - a.nftfan2;
    });

    articles.forEach(function(article) {
        var articleNode = document.createElement("div");
        articleNode.className = "article";

        // Add title bar
        var titleBar = document.createElement("div");
        titleBar.className = "title-bar";

        // Add title
        var titleNode = document.createElement("div");
        titleNode.className = "title";
        titleNode.innerText = article.title;
        titleBar.appendChild(titleNode);

        // Create button for tokens earned
        var tokensButton = document.createElement("button");
        tokensButton.className = "tokens-button";
        tokensButton.style.fontSize = "8px";
        tokensButton.innerText = "Tokens Earned: " + calculateTokensEarned(article.text);
        titleBar.appendChild(tokensButton);

        articleNode.appendChild(titleBar);

        // Add posted by and wallet address
        var postedByNode = document.createElement("p");
        postedByNode.innerText = "Posted by: ";
        var walletNode = document.createElement("span");
        walletNode.className = "wallet";
        walletNode.innerText = article.wallet;
        postedByNode.appendChild(walletNode);
        articleNode.appendChild(postedByNode);

        // Add article text
        var textNode = document.createElement("p");
        textNode.innerText = article.text;
        articleNode.appendChild(textNode);

        // Add datetime
        var datetimeNode = document.createElement("p");
        datetimeNode.className = "datetime";
        datetimeNode.innerText = formatDateTime(article.nftfan2);
        articleNode.appendChild(datetimeNode);

        articlesSection.appendChild(articleNode);
    });
}


// Function to calculate tokens earned (assuming 1 token per word)
function calculateTokensEarned(text) {
    var wordCount = text.split(/\s+/).length;
    return wordCount; // 1 token per word
}



    function formatDateTime(timestamp) {
        var date = new Date(parseInt(timestamp));
        var options = {
            year: "numeric",
            month: "short",
            day: "numeric",
            hour: "numeric",
            minute: "numeric"
        };
        return date.toLocaleDateString(undefined, options);
    }

    function displayError(message) {
        var errorMessage = document.getElementById("errorMessage");
        errorMessage.textContent = message;
    }
    
    function clearError() {
        var errorMessage = document.getElementById("errorMessage");
        errorMessage.textContent = "";
    }

    




</script>

</body>
</html>
